<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Bol√£o Colaboradores Camino</title>
<style>
    /* --- RESET E VARI√ÅVEIS --- */
    :root {
        --primary-color: #ffd700;
        --bg-gradient: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #2c3e50);
    }

    /* Anima√ß√£o do Fundo */
    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
    }

    body {
        box-sizing: border-box;
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: var(--bg-gradient);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100dvh;
        color: #fff;
        padding: 15px;
    }

    /* --- CONTAINER PRINCIPAL --- */
    .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        width: 100%;
        max-width: 480px;
        border-radius: 20px;
        padding: 25px 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        text-align: center;
        color: #333;
        position: relative;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    /* --- LOGO --- */
    .logo-img {
        display: block;
        max-width: 80%;
        height: auto;
        margin: 0 auto 10px auto;
        max-height: 100px;
    }

    /* Tipografia */
    h1 {
        font-size: clamp(1.1rem, 5vw, 1.5rem);
        color: #d63031;
        margin-bottom: 8px;
        font-weight: 800;
        line-height: 1.2;
        text-transform: uppercase;
    }
    
    .info {
        font-size: clamp(0.9rem, 4vw, 1rem);
        color: #444;
        margin-bottom: 15px;
        line-height: 1.4;
    }

    /* --- CONTADOR --- */
    .countdown-wrapper {
        background: rgba(0, 0, 0, 0.85);
        border-radius: 12px;
        padding: 10px;
        margin: 15px 0;
        border: 1px solid rgba(255, 215, 0, 0.5);
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .countdown-label { 
        margin: 0 0 5px 0; font-size: 0.75rem; 
        opacity: 0.9; text-transform: uppercase; color: #fff; letter-spacing: 1px;
    }
    .countdown { 
        display: flex; justify-content: center; align-items: center; 
        color: #ffd700; font-weight: bold; gap: 5px;
    }
    .time-block { display: flex; flex-direction: column; align-items: center; min-width: 18%; }
    .time-block span { 
        font-size: clamp(1.2rem, 6vw, 1.5rem);
        line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.5); 
    }
    .time-block small { 
        font-size: 0.6rem; color: #ddd; text-transform: uppercase; margin-top: 2px; 
    }
    .separator { font-size: 1.2rem; color: rgba(255, 255, 255, 0.4); margin-bottom: 8px; }

    /* --- PROGRESSO --- */
    .progress-container {
        margin: 15px 0; padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #e0e0e0;
        border-radius: 12px;
    }
    .progress-bar { 
        width: 100%; height: 18px; 
        background: #e0e0e0; border-radius: 10px; overflow: hidden; 
    }
    .progress-fill {
        height: 100%; width: 0%;
        background: linear-gradient(90deg, #ffd700, #ffb347, #00b894);
        transition: width 1s ease; border-radius: 10px;
    }
    .progress-text { font-size: 0.9rem; margin-top: 5px; color: #333; font-weight: 700; }
    .progress-subtext { font-size: 0.75rem; color: #666; }

    /* --- INPUTS (COM PULSAR LEVE) --- */
    
    @keyframes pulse-input {
        0% { transform: scale(1); box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-color: #e0e0e0; }
        50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(0, 148, 50, 0.15); border-color: #badc58; }
        100% { transform: scale(1); box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-color: #e0e0e0; }
    }

    input {
        width: 100%;
        box-sizing: border-box;
        padding: 16px;
        margin: 10px 0;
        background: #fff;
        border: 2px solid #e0e0e0;
        border-bottom: 5px solid #009432;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        color: #333;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        animation: pulse-input 3s infinite ease-in-out;
    }
    
    input::placeholder {
        color: #aaa;
        font-weight: 400;
        letter-spacing: 1px;
    }

    input:focus { 
        border-color: #d63031;
        outline: none; 
        animation: none; 
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }

    /* --- BOT√ïES --- */
    button {
        width: 100%;
        padding: 14px;
        margin-top: 8px;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    button:active { transform: scale(0.98); }

    .btn-grid { 
        display: grid; 
        grid-template-columns: 1fr 2fr; 
        gap: 10px; 
        margin-top: 10px; 
    }
    
    .btn-primary { 
        grid-column: 1 / 2; 
        background: linear-gradient(135deg, #7f8c8d, #95a5a6); color: white;
        font-size: 0.9rem;
    }
    
    .btn-secondary {
        grid-column: 2 / 3;
        background: linear-gradient(135deg, #009432, #2ecc71);
        color: white;
        border: 1px solid rgba(255,255,255,0.2);
        animation: pulse-green 2s infinite;
    }

    .btn-whatsapp {
        grid-column: 1 / -1; 
        background: linear-gradient(135deg, #25d366, #128c7e); color: white;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        margin-top: 5px;
    }
    
    .btn-regras {
        background: #95a5a6; color: white; 
        font-size: 0.8rem; padding: 6px 12px; 
        width: auto; display: inline-block; margin: 0;
    }

    @keyframes pulse-green {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(0, 148, 50, 0.4); }
        100% { transform: scale(1); }
    }

    /* --- MODAIS --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.85); 
        display: none;
        justify-content: center; align-items: center; 
        z-index: 1000;
        padding: 10px;
    }
    .modal {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        border-radius: 15px; 
        width: 100%; 
        max-width: 500px; 
        max-height: 85dvh; 
        padding: 20px; 
        color: #fff; 
        overflow-y: auto; 
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .lista {
        text-align: left; font-size: 0.9rem; 
        max-height: 40vh; 
        overflow-y: auto;
        background: rgba(0,0,0,0.2); 
        border-radius: 12px; 
        padding: 8px; margin-top: 15px;
    }
    .participante {
        padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.08);
        border-radius: 8px; display: flex; justify-content: space-between; align-items: center;
        gap: 8px;
    }
    
    .status { font-weight: bold; font-size: 0.7rem; padding: 3px 6px; border-radius: 4px; text-transform: uppercase; white-space: nowrap; }
    .status.pago { background: #00b894; color: #fff; }
    .status.nao-pago { background: #e74c3c; color: #fff; }
    .status.parcial { background: #f39c12; color: #fff; }

    /* --- RESPONSIVIDADE PEQUENA --- */
    @media (max-width: 380px) {
        .container { padding: 15px 12px; }
        h1 { font-size: 1.2rem; }
        .logo-img { max-height: 80px; }
        .btn-grid { grid-template-columns: 1fr; gap: 8px; }
        .btn-primary, .btn-secondary { grid-column: auto; }
    }

    /* Utilit√°rios */
    .prize-button { 
        background: linear-gradient(135deg, #00b894, #00cec9); 
        padding: 8px 15px; border-radius: 20px; color: white; font-weight: bold; 
        display: inline-block; box-shadow: 0 4px 10px rgba(0,184,148,0.4); 
        margin-top: 5px; font-size: 0.9rem; white-space: nowrap;
    }
    .message { margin-top: 15px; padding: 10px; border-radius: 10px; font-weight: bold; font-size: 0.9rem; }
    .message.success { background: rgba(0, 184, 148, 0.2); color: #00b894; border: 1px solid #00b894; }
    .message.error { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }
    
    /* Inputs Admin */
    .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 15px; }
    .num-btn { background: #34495e; padding: 12px; font-size: 1.2rem; margin: 0; }
</style>
</head>
<body>

<div class="container">
    <img src="1001855377.png" alt="Logo Camino Supermercados" class="logo-img">
    
    <h1 id="tituloBolao"><strong>Bol√£o dos Colaboradores Camino</strong></h1>
    
    <div class="info" id="infoGeral">
        </div>
    
    <div class="countdown-wrapper">
        <p class="countdown-label">‚è∞ Encerramento das Cotas:</p>
        <div id="countdown" class="countdown">
            <div class="time-block"><span id="dias">00</span><small>Dias</small></div>
            <div class="separator">:</div>
            <div class="time-block"><span id="horas">00</span><small>Hs</small></div>
            <div class="separator">:</div>
            <div class="time-block"><span id="minutos">00</span><small>Min</small></div>
            <div class="separator">:</div>
            <div class="time-block"><span id="segundos">00</span><small>Seg</small></div>
        </div>
    </div>

    <div style="font-size: 0.9rem; margin: 10px 0;">
        üìÖ <strong>Pagamento:</strong> at√© 10 de Dezembro<br>
    </div>

    <div style="display: flex; justify-content: flex-end; margin-bottom: 5px;">
        <button id="verRegras" class="btn-regras">üìã Regras</button>
    </div>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Carregando...</div>
        <div class="progress-subtext" id="progressSubtext">Arrecadado: R$ 0,00</div>
    </div>

    <input type="text" id="nome" placeholder="NOME COMPLETO" required>
    <input type="tel" id="telefone" placeholder="WHATSAPP (com DDD)" required>
    
    <div class="btn-grid">
        <button id="verLista" class="btn-primary">üìã LISTA</button>
        <button id="cadastrar" class="btn-secondary">üöÄ PARTICIPAR</button>
        <button id="entrarGrupo" class="btn-whatsapp">
            <span style="font-size: 1.2rem; margin-right: 5px;">üí¨</span> GRUPO WHATSAPP
        </button>
    </div>

    <div class="message" id="mensagem"></div>
</div>

<div class="modal-overlay" id="overlay">
    <div class="modal">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0">üìã Participantes</h3>
            <button id="fecharListaX" style="background:none; border:none; font-size:1.5rem; width:auto; padding:0; color:#fff; margin:0;">‚úï</button>
        </div>
        
        <div class="progress-container" style="padding:8px; margin:5px 0;">
            <div class="progress-bar"><div class="progress-fill" id="progressFillLista"></div></div>
            <div class="progress-text" id="progressTextLista" style="color:#fff; font-size:0.8rem">...</div>
        </div>
        
        <input type="text" id="buscar" placeholder="üîç Buscar..." style="margin-bottom:10px;">
        
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <button id="filtroTodos" style="flex:1; padding:8px; font-size:0.8rem; margin:0; background:#7f8c8d;">Todos</button>
            <button id="filtroPagos" style="flex:1; padding:8px; font-size:0.8rem; margin:0; background:#00b894;">Pagos</button>
            <button id="filtroPendentes" style="flex:1; padding:8px; font-size:0.8rem; margin:0; background:#e74c3c;">Pend</button>
        </div>
        
        <div style="display:flex; gap:5px; border-top:1px solid rgba(255,255,255,0.2); padding-top:10px;">
             <button id="btnAdminPagamento" style="background:#f39c12; font-size:0.8rem; padding:8px; margin:0;">üí∞ Gerir Pgto</button>
             <button id="btnAdminExcluir" style="background:#c0392b; font-size:0.8rem; padding:8px; margin:0;">üóëÔ∏è Excluir</button>
             <button id="btnAdminTelegram" style="background:#2980b9; font-size:1.2rem; padding:8px; margin:0; width:40px;">‚úàÔ∏è</button>
        </div>

        <div class="lista" id="lista"></div>
    </div>
</div>

<div id="modalSenha" class="modal-overlay" style="z-index: 2000;">
    <div class="modal" style="max-width:320px;">
        <h4>üîê Senha Admin</h4>
        <div id="senhaDisplay" style="font-size:1.5rem; letter-spacing:5px; min-height:30px; margin-bottom:10px;"></div>
        <div class="numpad">
            <button class="num-btn" data-num="1">1</button><button class="num-btn" data-num="2">2</button><button class="num-btn" data-num="3">3</button>
            <button class="num-btn" data-num="4">4</button><button class="num-btn" data-num="5">5</button><button class="num-btn" data-num="6">6</button>
            <button class="num-btn" data-num="7">7</button><button class="num-btn" data-num="8">8</button><button class="num-btn" data-num="9">9</button>
            <button id="limparSenha" style="background:#c0392b; margin:0;">C</button>
            <button class="num-btn" data-num="0">0</button>
            <button id="cancelarSenha" style="background:#7f8c8d; margin:0;">‚úï</button>
        </div>
    </div>
</div>

<div id="modalPagamentoAdm" class="modal-overlay" style="z-index: 3000;">
    <div class="modal" style="max-width:320px;">
        <h3>üí∞ Definir Valor</h3>
        <p id="nomeParticipantePagamento" style="color:#ffd700"></p>
        <input type="number" id="valorInputAdm" placeholder="R$ 0,00" style="font-size:1.2rem; margin:15px 0;">
        <div style="display:flex; gap:10px;">
            <button class="quick-val" data-val="0" style="background:#e74c3c; margin:0;">Zerar</button>
            <button class="quick-val" data-val="100" style="background:#00b894; margin:0;">R$ 100</button>
        </div>
        <button id="salvarPagamento" style="background:#27ae60; margin-top:15px;">üíæ Salvar</button>
        <button id="fecharPagamentoAdm" style="background:#7f8c8d;">Cancelar</button>
    </div>
</div>

<div id="modalConfirmacao" class="modal-overlay" style="z-index: 4000;">
    <div class="modal">
        <div style="font-size: 3rem; margin-bottom: 10px;">üéâ</div>
        <h3>Cadastro Sucesso!</h3>
        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:10px; text-align:left; margin:10px 0;">
            <div><strong>Nome:</strong> <span id="confirmNome"></span></div>
            <div><strong>WhatsApp:</strong> <span id="confirmTelefone"></span></div>
        </div>
        <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:10px; margin:10px 0; font-size:0.9rem;">
            <div><strong>PIX:</strong> <span id="confirmPix"></span></div>
            <div><strong>Valor:</strong> R$ <span id="confirmValor"></span></div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button id="btnWhatsAppPagamento" style="background:#25d366; margin:0;">WhatsApp</button>
            <button id="btnCopiarPix" style="background:#3498db; margin:0;">Copiar PIX</button>
        </div>
        <button id="fecharConfirmacao" style="background:#34495e; margin-top:10px;">Fechar</button>
    </div>
</div>

<div id="modalRegras" class="modal-overlay">
    <div class="modal">
        <h3>‚ÑπÔ∏è Regras</h3>
        <div style="text-align:left; font-size:0.9rem; line-height:1.5;">
            <p>1. Cota √önica: R$ 100,00</p>
            <p>2. Pagamento at√© 10/12</p>
            <p>3. N√£o pagou = Exclu√≠do</p>
            <p>4. Pagamento parcial fica "Laranja"</p>
        </div>
        <button id="fecharRegras" style="background:#c0392b;">Fechar</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, get, update, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// === CONFIG ===
const CONFIG = {
  LIMITE: 60,
  VALOR: 100.00,
  PREMIO: 1200000.00,
  PRAZO: "10 de Dezembro",
  TITULO: "BOL√ÉO DOS COLABORADORES CAMINO",
  PIX: "(99) 9 9102-6112",
  PIX_KEY: "00020126330014br.gov.bcb.pix0111057968793755204000053039865406100.005802BR5922Vagner Sousa Lauriuche6009Sao Paulo62290525REC690A942DB7E1336267138563049C6B",
  SENHA: '6261',
  TG_TOKEN: "8307035824:AAFsKe4l1WgbZI1uez-n06Vt-TYiuhZLMt8",
  TG_CHAT: "861365063"
};

const app = initializeApp({
  apiKey: "AIzaSyCvXGUdvZkqtSMMn8VmTOXLA9PXqR85gSk",
  authDomain: "vagner-34d5b.firebaseapp.com",
  databaseURL: "https://vagner-34d5b.firebaseio.com",
  projectId: "vagner-34d5b",
  storageBucket: "vagner-34d5b.firebasestorage.app",
  messagingSenderId: "711539772164",
  appId: "1:711539772164:web:e7736325e6ed365c0bde51"
});

const db = getDatabase(app);
const dbRef = ref(db, "participantes");

let participantes = [];
let selecionados = [];
let senhaDigitada = '';
let acaoAdmin = null;

// === HELPERS ===
const fmtMoney = v => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
const fmtNum = n => n.toString().padStart(2, '0');
const msg = (txt, tipo='success') => {
    const m = document.getElementById('mensagem');
    m.textContent = txt; m.className = `message ${tipo}`;
    setTimeout(() => { m.textContent=''; m.className='message'; }, 3000);
};

// === LOGIC ===
async function updateData() {
    const snap = await get(dbRef);
    participantes = snap.exists() ? Object.entries(snap.val()).map(([k,v]) => ({...v, key:k})) : [];
    
    const total = participantes.length;
    const arrecadado = participantes.reduce((acc, p) => acc + (p.valorPago || 0), 0);
    const pct = (total / CONFIG.LIMITE) * 100;

    // Home
    document.getElementById('progressFill').style.width = `${pct}%`;
    document.getElementById('progressText').textContent = `${total}/${CONFIG.LIMITE} participantes`;
    document.getElementById('progressSubtext').textContent = `Arrecadado: ${fmtMoney(arrecadado)}`;
    
    // Modal Lista
    const elListFill = document.getElementById('progressFillLista');
    if(elListFill) {
        elListFill.style.width = `${pct}%`;
        const pagosFull = participantes.filter(p => (p.valorPago||0) >= CONFIG.VALOR).length;
        document.getElementById('progressTextLista').textContent = `${total} Total ‚Ä¢ ${pagosFull} Pagos (100%)`;
    }
}

// === LISTA ===
function getStatus(v) {
    v = parseFloat(v||0);
    if(v >= CONFIG.VALOR) return {t:"PAGO", c:"pago", i:"‚úÖ"};
    if(v > 0) return {t:`PARCIAL`, c:"parcial", i:"‚ö†Ô∏è"};
    return {t:"PENDENTE", c:"nao-pago", i:"‚ùå"};
}

function renderList(filterFn = null) {
    const div = document.getElementById("lista");
    div.innerHTML = "";
    const data = filterFn ? participantes.filter(filterFn) : participantes;
    
    if(!data.length) return div.innerHTML = "<div style='text-align:center; padding:10px; color:#aaa'>Vazio</div>";

    data.sort((a,b) => a.numero - b.numero).forEach(p => {
        const st = getStatus(p.valorPago);
        const sel = selecionados.some(s => s.key === p.key);
        
        const el = document.createElement("div");
        el.className = "participante";
        if(sel) el.style.background = "rgba(255,215,0,0.2)";
        
        const valTxt = st.c === 'parcial' ? `<span style="font-size:0.7rem; color:#f39c12">(${fmtMoney(p.valorPago)})</span>` : '';

        // NOME COMPLETO AQUI
        el.innerHTML = `
            <div style="display:flex; align-items:center; width:100%; gap:10px;">
                <input type="checkbox" ${sel?'checked':''} style="width:18px; height:18px; margin:0; flex-shrink:0;">
                <div style="flex:1; text-align:left; word-break: break-word;">
                    <span style="font-weight:bold">${fmtNum(p.numero)}. ${p.nome}</span>
                </div>
                <div style="flex-shrink:0; display:flex; align-items:center; gap:5px;">
                    ${valTxt}
                    <span class="status ${st.c}">${st.i}</span>
                </div>
            </div>
        `;
        
        el.onclick = (e) => {
            if(e.target.type !== 'checkbox') {
                const chk = el.querySelector('input');
                chk.checked = !chk.checked;
            }
            toggleSel(p);
        };
        div.appendChild(el);
    });
}

function toggleSel(p) {
    const idx = selecionados.findIndex(s => s.key === p.key);
    if(idx >= 0) selecionados.splice(idx, 1);
    else selecionados.push(p);
    renderList(getCurrentFilter()); 
}

let currentFilter = 'todos';
function getCurrentFilter() {
    if(currentFilter === 'pagos') return p => (p.valorPago||0) >= CONFIG.VALOR;
    if(currentFilter === 'pendentes') return p => (p.valorPago||0) < CONFIG.VALOR;
    return null;
}

// === ACTIONS ===
document.getElementById('cadastrar').onclick = async () => {
    const n = document.getElementById('nome').value.trim().toUpperCase();
    const t = document.getElementById('telefone').value.trim();
    if(!n || !t || n.split(' ').length < 2) return msg("Nome completo e Zap!", "error");
    
    const snap = await get(dbRef);
    const all = snap.exists() ? Object.values(snap.val()) : [];
    if(all.length >= CONFIG.LIMITE) return msg("Lotou!", "error");
    if(all.some(p => p.nome === n)) return msg("J√° existe!", "error");
    
    const novo = { numero: all.length+1, nome: n, telefone: t, valorPago: 0 };
    await push(dbRef, novo);
    
    document.getElementById('nome').value = '';
    document.getElementById('telefone').value = '';
    
    // Confirma√ß√£o
    document.getElementById('confirmNome').innerText = n;
    document.getElementById('confirmTelefone').innerText = t;
    document.getElementById('confirmPix').innerText = CONFIG.PIX;
    document.getElementById('confirmValor').innerText = CONFIG.VALOR.toFixed(2);
    document.getElementById('modalConfirmacao').style.display = 'flex';
    
    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    updateData();
    sendTG(`‚ûï *Novo:* ${n}`);
};

// Admin Flow
function askPass(action) {
    if(!selecionados.length && action !== 'telegram') return msg("Selecione algu√©m!", "error");
    acaoAdmin = action;
    senhaDigitada = '';
    document.getElementById('senhaDisplay').innerText = '';
    document.getElementById('modalSenha').style.display = 'flex';
}

async function doAction() {
    if(acaoAdmin === 'pagamento') {
        if(selecionados.length !== 1) return alert("Selecione 1 pessoa.");
        const p = selecionados[0];
        document.getElementById('nomeParticipantePagamento').innerText = p.nome;
        document.getElementById('valorInputAdm').value = p.valorPago || 0;
        document.getElementById('modalPagamentoAdm').style.display = 'flex';
    }
    else if(acaoAdmin === 'excluir') {
        if(confirm(`Apagar ${selecionados.length}?`)) {
            const u = {}; selecionados.forEach(p => u[`participantes/${p.key}`] = null);
            await update(ref(db), u);
            selecionados = []; updateData(); renderList(); msg("Exclu√≠do!");
        }
    }
    else if(acaoAdmin === 'telegram') {
        const txt = participantes.sort((a,b)=>a.numero-b.numero)
            .map(p => `${fmtNum(p.numero)} ${getStatus(p.valorPago).i} ${p.nome}`).join('\n');
        await sendTG(`üìä *Lista*\n${txt}`);
        msg("Enviado!");
    }
}

// Numpad
document.querySelectorAll('.num-btn').forEach(b => {
    b.onclick = () => {
        senhaDigitada += b.dataset.num;
        document.getElementById('senhaDisplay').innerText = '*'.repeat(senhaDigitada.length);
        if(senhaDigitada.length === 4) {
            setTimeout(() => {
                if(senhaDigitada === CONFIG.SENHA) {
                    document.getElementById('modalSenha').style.display = 'none';
                    doAction();
                } else {
                    msg("Senha errada", "error");
                    senhaDigitada = ''; document.getElementById('senhaDisplay').innerText='';
                }
            }, 100);
        }
    }
});
document.getElementById('limparSenha').onclick = () => { senhaDigitada=''; document.getElementById('senhaDisplay').innerText=''; };
document.getElementById('cancelarSenha').onclick = () => document.getElementById('modalSenha').style.display = 'none';

// Save Payment
document.getElementById('salvarPagamento').onclick = async () => {
    const v = parseFloat(document.getElementById('valorInputAdm').value);
    if(isNaN(v) || v < 0) return alert("Valor inv√°lido");
    await update(ref(db, `participantes/${selecionados[0].key}`), { valorPago: v });
    document.getElementById('modalPagamentoAdm').style.display = 'none';
    selecionados = []; updateData(); renderList(); msg("Atualizado!");
};
document.querySelectorAll('.quick-val').forEach(b => b.onclick = () => document.getElementById('valorInputAdm').value = b.dataset.val);
document.getElementById('fecharPagamentoAdm').onclick = () => document.getElementById('modalPagamentoAdm').style.display = 'none';

// Filter Buttons
document.getElementById('filtroTodos').onclick = () => { currentFilter='todos'; renderList(); };
document.getElementById('filtroPagos').onclick = () => { currentFilter='pagos'; renderList(p => (p.valorPago||0)>=CONFIG.VALOR); };
document.getElementById('filtroPendentes').onclick = () => { currentFilter='pendentes'; renderList(p => (p.valorPago||0)<CONFIG.VALOR); };
document.getElementById('buscar').oninput = (e) => renderList(p => p.nome.includes(e.target.value.toUpperCase()));

// UI Bindings
document.getElementById('verLista').onclick = () => { updateData(); renderList(); document.getElementById('overlay').style.display='flex'; };
document.getElementById('fecharListaX').onclick = () => { document.getElementById('overlay').style.display='none'; selecionados=[]; };
document.getElementById('btnAdminPagamento').onclick = () => askPass('pagamento');
document.getElementById('btnAdminExcluir').onclick = () => askPass('excluir');
document.getElementById('btnAdminTelegram').onclick = () => askPass('telegram');
document.getElementById('btnCopiarPix').onclick = () => { navigator.clipboard.writeText(CONFIG.PIX_KEY); alert("PIX Copiado!"); };
document.getElementById('btnWhatsAppPagamento').onclick = () => {
    const n = document.getElementById('confirmNome').innerText;
    window.open(`https://wa.me/55${CONFIG.PIX.replace(/\D/g,'')}?text=Ola, cadastro feito: ${n}`);
};
document.getElementById('fecharConfirmacao').onclick = () => document.getElementById('modalConfirmacao').style.display='none';
document.getElementById('verRegras').onclick = () => document.getElementById('modalRegras').style.display='flex';
document.getElementById('fecharRegras').onclick = () => document.getElementById('modalRegras').style.display='none';
document.getElementById('entrarGrupo').onclick = () => window.open("https://chat.whatsapp.com/Fdl9PzkiEBq9TnJHtlu2Rm", "_blank");

async function sendTG(t) {
    try { await fetch(`https://api.telegram.org/bot${CONFIG.TG_TOKEN}/sendMessage`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({chat_id:CONFIG.TG_CHAT, text:t, parse_mode:'Markdown'}) }); } catch(e){}
}

// Init
document.getElementById('tituloBolao').innerHTML = `<strong>${CONFIG.TITULO}</strong>`;
document.getElementById('infoGeral').innerHTML = `
    üé∞ <strong>${CONFIG.LIMITE} pessoas</strong> ‚Ä¢ üí∞ <strong>${fmtMoney(CONFIG.VALOR)} por pessoa</strong>
    <div style="margin-top:5px;">
        <span class="prize-button">üèÜ R$ 850 Milh√µes</span>
    </div>`;

setInterval(() => {
    const d = new Date(`Dec 10, 2025 23:59:59`).getTime() - Date.now();
    if(d<0) return;
    document.getElementById('dias').innerText = fmtNum(Math.floor(d/(864e5)));
    document.getElementById('horas').innerText = fmtNum(Math.floor((d%864e5)/36e5));
    document.getElementById('minutos').innerText = fmtNum(Math.floor((d%36e5)/6e4));
    document.getElementById('segundos').innerText = fmtNum(Math.floor((d%6e4)/1e3));
}, 1000);
updateData();
</script>
</body>
</html>
