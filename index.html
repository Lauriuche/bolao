<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bol√£o Mega da Virada 2025</title>
<style>
    body {
        box-sizing: border-box;
        margin: 0;
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100%;
        color: #fff;
        padding: 20px;
    }
    
    html {
        height: 100%;
    }
    
    .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        width: 95%;
        max-width: 480px;
        border-radius: 25px;
        padding: 30px 25px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        text-align: center;
        color: #333;
        position: relative;
    }
    
    
    h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 8px;
        font-weight: 700;
    }
    
    .info {
        font-size: 15px;
        color: #333;
        margin-bottom: 20px;
        line-height: 1.5;
    }
    
    .progress-container {
        margin: 20px 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .progress-bar {
        width: 100%;
        height: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #ffd700, #ffb347, #00b894);
        width: 0%;
        transition: width 1s ease;
        border-radius: 12px;
    }
    
    .progress-text {
        font-size: 14px;
        margin-top: 10px;
        color: #333;
        font-weight: 600;
    }
    
    input {
        width: 90%;
        padding: 14px 16px;
        margin: 8px 0;
        border: 3px solid #ffd700;
        border-radius: 15px;
        font-size: 15px;
        text-align: center;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    input:focus {
        border-color: #ff9800;
        outline: none;
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
    }
    
    button {
        width: 92%;
        padding: 16px;
        margin-top: 12px;
        border: none;
        border-radius: 15px;
        background: linear-gradient(135deg, #ffd700, #ffb347);
        color: #333;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    button:hover {
        transform: translateY(-2px);
        background: linear-gradient(135deg, #ffed4e, #ffc947);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }
    
    .btn-grid {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 10px;
        margin-top: 8px;
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, #6c757d, #adb5bd);
        color: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .btn-secondary:hover {
        background: linear-gradient(135deg, #5a6268, #95a5a6);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }
    
    .message {
        margin-top: 15px;
        font-size: 15px;
        font-weight: 600;
        padding: 10px;
        border-radius: 10px;
    }
    
    .success {
        color: #00b894;
        background: rgba(0, 184, 148, 0.1);
        border: 1px solid rgba(0, 184, 148, 0.3);
    }
    
    .error {
        color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
        border: 1px solid rgba(231, 76, 60, 0.3);
    }
    
    .warning {
        color: #f39c12;
        background: rgba(243, 156, 18, 0.1);
        border: 1px solid rgba(243, 156, 18, 0.3);
    }
    
    /* Bot√£o de premia√ß√£o destacado */
    .prize-button {
        background: linear-gradient(135deg, #00b894, #00cec9);
        color: white;
        font-weight: bold;
        padding: 12px 20px;
        border-radius: 12px;
        margin: 5px 0;
        box-shadow: 0 6px 15px rgba(0, 184, 148, 0.4);
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
        display: inline-block;
        font-size: 14px;
        text-align: center;
    }
    
    .prize-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 184, 148, 0.6);
    }
    
    /* Modal */
    .modal-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .modal {
        background: linear-gradient(135deg, rgba(44, 62, 80, 0.95) 0%, rgba(52, 73, 94, 0.95) 100%);
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        padding: 25px;
        color: #fff;
        overflow-y: auto;
    }
    
    .modal h3 {
        margin-top: 0;
        font-size: 24px;
        color: #ffd700;
        margin-bottom: 20px;
    }
    
    .close-btn {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
        width: auto;
    }
    
    .lista {
        text-align: left;
        font-size: 13px;
        max-height: 400px;
        overflow-y: auto;
        color: #fff;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        margin: 15px 0;
    }
    
    .participante {
        padding: 12px;
        margin: 5px 0;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
        gap: 10px;
    }
    
    .participante:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
    }
    
    .status {
        font-weight: bold;
        text-transform: uppercase;
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 6px;
    }
    
    .pago {
        color: #fff;
        background: linear-gradient(135deg, #00b894, #00cec9);
    }
    
    .nao-pago {
        color: #fff;
        background: linear-gradient(135deg, #e74c3c, #ff6b6b);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .nao-pago:hover {
        background: linear-gradient(135deg, #c0392b, #e74c3c);
        transform: scale(1.05);
    }

    
    /* Anima√ß√µes para mensagem sobre modal */
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }
    
    @keyframes slideUp {
        from {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        to {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
        }
    }
    
    @media (max-width: 768px) {
        .container {
            padding: 20px 18px;
            width: 98%;
        }
        
        .modal {
            width: 95%;
            padding: 20px;
        }
    }
</style>
</head>
<body>

<div class="container">

    
    <h1 id="tituloBolao">üéØ <strong>Bol√£o Mega da Virada 2025</strong></h1>
    
    <div class="info" id="infoGeral">
        üé∞ <strong>60 participantes</strong> ‚Ä¢ üí∞ <strong>R$ 100,00 por pessoa</strong><br>
        <div style="margin-top: 10px;">
            <span class="prize-button">üèÜ Premia√ß√£o Estimada: R$ 1.200.000,00</span>
        </div>
        üìÖ <strong>Pagamento:</strong> at√© 10 de Dezembro<br>
        <small>üìã Preencha os dados para garantir sua vaga!</small>
    </div>

    <!-- Bot√£o de regras posicionado acima da barra de progresso -->
    <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
        <button id="verRegras" style="background: linear-gradient(135deg, #95a5a6, #bdc3c7); font-size: 14px; padding: 10px 15px; border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); width: auto; min-width: 100px;">üìã Regras</button>
    </div>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0/60 participantes</div>
        <div style="font-size: 11px; margin-top: 5px; opacity: 0.7;" id="progressSubtext">
            Arrecadado: R$ 0,00
        </div>
    </div>

    <input type="text" id="nome" placeholder="NOME COMPLETO" required>
    <input type="tel" id="telefone" placeholder="WHATSAPP (com DDD)" required>
    
    <div class="btn-grid">
        <button id="verLista" class="btn-secondary">üìãLISTA</button>
        <button id="cadastrar">üöÄPARTICIPAR</button>
    </div>

    <div class="message" id="mensagem"></div>
</div>

<div class="modal-overlay" id="overlay">
    <div class="modal">
        <h3><strong>üìã Lista de Participantes</strong></h3>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFillLista"></div>
            </div>
            <div class="progress-text" id="progressTextLista" style="color: #fff; font-weight: bold;">0/80 cadastrados ‚Ä¢ 0 pagos</div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <input type="text" id="buscar" placeholder="üîç Buscar participante..." style="width: 100%; padding: 12px; border: 2px solid rgba(52, 152, 219, 0.2); border-radius: 12px; background: rgba(255, 255, 255, 0.9); color: #333; margin-bottom: 10px; box-sizing: border-box;">
            
            <div style="display: flex; gap: 8px; justify-content: flex-start;">
                <button id="filtroBtn" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">üîç</button>
                
                <button id="acaoBtn" style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">‚öôÔ∏è</button>
            </div>
        </div>
        
        <div id="menuFiltros" style="display: none; background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <h4 style="color: #ffd700; margin: 0 0 10px 0; font-size: 14px;">üîç Filtros:</h4>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button id="filtroTodos" class="filter-btn" style="background: linear-gradient(135deg, #6c757d, #adb5bd); color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; flex: 1; min-width: 70px;">üë• Todos</button>
                <button id="filtroPagos" class="filter-btn" style="background: linear-gradient(135deg, #00b894, #00cec9); color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; flex: 1; min-width: 70px;">‚úÖ Pagos</button>
                <button id="filtroNaoPagos" class="filter-btn" style="background: linear-gradient(135deg, #e74c3c, #ff6b6b); color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; flex: 1; min-width: 70px;">‚ùå Pendentes</button>
            </div>
        </div>
        
        <div id="menuAcoes" style="display: none; background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <h4 style="color: #ffd700; margin: 0 0 10px 0; font-size: 14px;">‚öôÔ∏è A√ß√µes:</h4>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button id="alterarStatus" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; flex: 1; min-width: 80px;">üîÑ Status</button>
                <button id="notificar" style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; flex: 1; min-width: 80px;">üì± Notificar</button>
                <button id="excluir" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 8px 12px; border: none; border-radius: 8px; font-size: 11px; cursor: pointer; flex: 1; min-width: 80px;">üóëÔ∏è Excluir</button>
            </div>
        </div>

        <div id="modalSenha" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); z-index: 2000; justify-content: center; align-items: center;">
            <div style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 25px; border-radius: 15px; text-align: center; max-width: 300px; width: 90%;">
                <h4 style="color: #ffd700; margin: 0 0 15px 0; font-size: 16px;">üîê Senha de Administrador</h4>
                
                <div id="senhaDisplay" style="background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 18px; letter-spacing: 8px; min-height: 24px; color: #fff;"></div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                    <button class="num-btn" data-num="1" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">1</button>
                    <button class="num-btn" data-num="2" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">2</button>
                    <button class="num-btn" data-num="3" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">3</button>
                    <button class="num-btn" data-num="4" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">4</button>
                    <button class="num-btn" data-num="5" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">5</button>
                    <button class="num-btn" data-num="6" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">6</button>
                    <button class="num-btn" data-num="7" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">7</button>
                    <button class="num-btn" data-num="8" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">8</button>
                    <button class="num-btn" data-num="9" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">9</button>
                    <button id="limparSenha" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">üóëÔ∏è</button>
                    <button class="num-btn" data-num="0" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer;">0</button>
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #aaa;">Auto</div>
                </div>
                
                <button id="cancelarSenha" style="background: linear-gradient(135deg, #6c757d, #adb5bd); color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 12px; cursor: pointer; width: 100%;">‚ùå Cancelar</button>
            </div>
        </div>
        
        <div class="lista" id="lista"></div>
        
        <button class="close-btn" id="fecharLista">‚ùå Fechar</button>
    </div>
</div>

<div id="modalRegras" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); z-index: 2000; justify-content: center; align-items: center;">
    <div style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 25px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; color: #fff;">
        <h3 style="color: #ffd700; margin: 0 0 20px 0; font-size: 18px; text-align: center;">‚ö†Ô∏è INFORMATIVO: BOL√ÉO MEGA DA VIRADA ‚ö†Ô∏è</h3>
        
        <div style="text-align: left; line-height: 1.6; font-size: 14px;">
            <p style="margin-bottom: 15px;">Estamos organizando nosso bol√£o, com um total de <strong style="color: #ffd700;">60 participantes</strong>.</p>
            
            <p style="margin-bottom: 15px;"><strong style="color: #00b894;">Custo por Participante:</strong> R$ 100,00</p>
            
            <h4 style="color: #ffd700; margin: 20px 0 10px 0; font-size: 16px;">üìã Regras de Participa√ß√£o e Prazos:</h4>
            
            <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <h5 style="color: #e74c3c; margin: 0 0 10px 0;">üìÖ Datas Limite:</h5>
                <p style="margin: 0;"><strong>30 de Novembro:</strong> Data final para manifestar interesse (confirmar que quer participar).<br>
                <strong>10 de Dezembro:</strong> Data final para o pagamento da cota.</p>
            </div>
            
            <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #e74c3c;">
                <h5 style="color: #e74c3c; margin: 0 0 10px 0;">‚ö†Ô∏è Aten√ß√£o ao Pagamento:</h5>
                <p style="margin: 0;">O participante que n√£o realizar o pagamento at√© o dia <strong>10 de Dezembro</strong> ser√° automaticamente exclu√≠do do bol√£o, e a vaga ser√° repassada.</p>
            </div>
            
            <h4 style="color: #ffd700; margin: 20px 0 10px 0; font-size: 16px;">üí° Observa√ß√µes Importantes:</h4>
            
            <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px;">
                <p style="margin: 0 0 10px 0;"><strong style="color: #f39c12;">Prazos:</strong> As datas foram definidas para que todos tenham tempo suficiente para pagar (contando com o 13¬∫ sal√°rio).</p>
                
                <p style="margin: 0 0 10px 0;"><strong style="color: #f39c12;">Agilidade:</strong> Quanto antes arrecadarmos o valor, melhor. Deixar para a √∫ltima hora significa enfrentar lot√©ricas lotadas.</p>
                
                <p style="margin: 0;"><strong style="color: #f39c12;">Jogos:</strong> A quantidade final de bilhetes e jogos ser√° definida ao t√©rmino da arrecada√ß√£o, pois depender√° do valor total arrecadado (se todas as 60 cotas forem preenchidas).</p>
            </div>
        </div>
        
        <button id="fecharRegras" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 20px; width: 100%;">‚ùå Fechar</button>
    </div>
</div>

<div id="modalConfirmacao" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); z-index: 4000; justify-content: center; align-items: center;">
    <div style="background: linear-gradient(135deg, #00b894, #00cec9); padding: 25px; border-radius: 15px; max-width: 450px; width: 90%; color: #fff; text-align: center;">
        <div style="font-size: 48px; margin-bottom: 15px;">üéâ</div>
        <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 20px;">Cadastro Realizado!</h3>
        
        <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: left;">
            <div style="margin-bottom: 10px;"><strong>Nome:</strong> <span id="confirmNome"></span></div>
            <div><strong>WhatsApp:</strong> <span id="confirmTelefone"></span></div>
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; font-size: 14px;">
            <h4 style="color: #fff; margin: 0 0 10px 0; font-size: 16px;">üí≥ Para efetuar o pagamento:</h4>
            <div style="margin-bottom: 8px;"><strong>PIX:</strong> <span id="confirmPix"></span></div>
            <div style="margin-bottom: 8px;"><strong>Valor:</strong> R$ <span id="confirmValor"></span></div>
            <div><strong>Prazo:</strong> at√© <span id="confirmPrazo"></span></div>
        </div>
        
        <div id="qrCodeContainer" style="display: none; margin: 20px 0; text-align: center;">
            <img id="qrCodeImage" src="" alt="QR Code PIX" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: white;">
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
            <button id="btnWhatsAppPagamento" style="background: linear-gradient(135deg, #25d366, #128c7e); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 14px;">üì± WhatsApp</button>
            <button id="btnCopiarPix" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 14px;">üì± QR Code PIX</button>
        </div>
        
        <button id="fecharConfirmacao" style="background: linear-gradient(135deg, #34495e, #2c3e50); color: white; padding: 12px 24px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; width: 100%;">‚úÖ Entendi</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, get, update, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// Configura√ß√£o Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCvXGUdvZkqtSMMn8VmTOXLA9PXqR85gSk",
  authDomain: "vagner-34d5b.firebaseapp.com",
  databaseURL: "https://vagner-34d5b.firebaseio.com",
  projectId: "vagner-34d5b",
  storageBucket: "vagner-34d5b.firebasestorage.app",
  messagingSenderId: "711539772164",
  appId: "1:711539772164:web:e7736325e6ed365c0bde51"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db, "participantes");

// ========================================
// üîß CONFIGURA√á√ïES DO BOL√ÉO
// ========================================
// Altere apenas os valores abaixo conforme necess√°rio

const CONFIG = {
  // Participantes
  LIMITE_PARTICIPANTES: 60,
  VALOR_PARTICIPACAO: 100.00,
  PREMIACAO_ESTIMADA: 850000000.00,
  
  // Datas (formato: DD de M√™s)
  DATA_LIMITE_INTERESSE: "30 de Novembro",
  DATA_LIMITE_PAGAMENTO: "10 de Dezembro",
  
  // Contato
  PIX_PAGAMENTO: "(99) 9 9102-6112",
  PIX_QR_CODE: "00020126330014br.gov.bcb.pix0111057968793755204000053039865406100.005802BR5922Vagner Sousa Lauriuche6009Sao Paulo62290525REC690A942DB7E1336267138563049C6B",
  
  // Textos principais
  TITULO_BOLAO: "BOL√ÉO MEGA DA VIRADA 2025",
  ANO_SORTEIO: "2025",
  
  // Seguran√ßa
  SENHA_ADM: '6261',
  
  // Configura√ß√µes do Telegram
  TELEGRAM_TOKEN: "8307035824:AAFsKe4l1WgbZI1uez-n06Vt-TYiuhZLMt8", // ‚ö†Ô∏è ATEN√á√ÉO: Substitua pelo seu token.
  TELEGRAM_CHAT_ID: "861365063" // ‚ö†Ô∏è ATEN√á√ÉO: Substitua pelo ID do seu chat.
};

// ========================================
// Constantes derivadas (N√ÉO ALTERAR)
// ========================================
const LIMITE_PARTICIPANTES = CONFIG.LIMITE_PARTICIPANTES;
const VALOR_PARTICIPACAO = CONFIG.VALOR_PARTICIPACAO;
const SENHA_ADM = CONFIG.SENHA_ADM;
const TELEGRAM_TOKEN = CONFIG.TELEGRAM_TOKEN;
const TELEGRAM_CHAT_ID = CONFIG.TELEGRAM_CHAT_ID;

// Vari√°veis globais
let participantes = [];
let participanteSelecionado = null;
let participantesSelecionados = [];
let senhaDigitada = '';
let acaoPendente = null;

// Fun√ß√£o para formatar n√∫mero com 2 d√≠gitos
function formatarNumero(numero) {
  return numero.toString().padStart(2, '0');
}

// Fun√ß√£o para enviar lista para Telegram
async function enviarListaTelegram() {
  try {
    const listaTexto = participantes
      .sort((a, b) => a.numero - b.numero)
      .map(p => `${formatarNumero(p.numero)} - ${p.status === "Pago" ? "‚úÖ Pago" : "‚ùå N√£o pago"} - ${p.nome}`)
      .join('\n');
    
    const mensagem = `üìä *Lista Completa do Bol√£o*\n\n${listaTexto}`;
    
    const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: mensagem,
        parse_mode: 'Markdown'
      })
    });
    
    if (!response.ok) {
      throw new Error(`Erro HTTP: ${response.status}`);
    }
    
    console.log('Lista enviada para Telegram com sucesso!');
  } catch (error) {
    console.error('Erro ao enviar lista para Telegram:', error);
  }
}

// Fun√ß√£o para mostrar mensagens
function mostrarMensagem(texto, tipo) {
  const mensagem = document.getElementById('mensagem');
  mensagem.textContent = texto;
  mensagem.className = `message ${tipo}`;
  
  setTimeout(() => {
    mensagem.textContent = '';
    mensagem.className = 'message';
  }, 4000);
}

// Fun√ß√£o para mostrar mensagem sobre modal
function mostrarMensagemSobreModal(texto, tipo) {
  // Remover mensagem anterior se existir
  const mensagemExistente = document.getElementById('mensagemSobreModal');
  if (mensagemExistente) {
    mensagemExistente.remove();
  }
  
  // Criar nova mensagem
  const mensagem = document.createElement('div');
  mensagem.id = 'mensagemSobreModal';
  mensagem.textContent = texto;
  mensagem.style.cssText = `
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    padding: 15px 25px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 15px;
    text-align: center;
    max-width: 90%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.3s ease;
  `;
  
  // Aplicar cores baseado no tipo
  if (tipo === 'success') {
    mensagem.style.color = '#fff';
    mensagem.style.background = 'linear-gradient(135deg, #00b894, #00cec9)';
    mensagem.style.border = '2px solid rgba(0, 184, 148, 0.5)';
  } else if (tipo === 'error') {
    mensagem.style.color = '#fff';
    mensagem.style.background = 'linear-gradient(135deg, #e74c3c, #ff6b6b)';
    mensagem.style.border = '2px solid rgba(231, 76, 60, 0.5)';
  } else if (tipo === 'warning') {
    mensagem.style.color = '#fff';
    mensagem.style.background = 'linear-gradient(135deg, #f39c12, #e67e22)';
    mensagem.style.border = '2px solid rgba(243, 156, 18, 0.5)';
  }
  
  document.body.appendChild(mensagem);
  
  // Remover ap√≥s 3 segundos
  setTimeout(() => {
    if (mensagem && mensagem.parentNode) {
      mensagem.style.animation = 'slideUp 0.3s ease';
      setTimeout(() => {
        mensagem.remove();
      }, 300);
    }
  }, 3000);
}

// Fun√ß√£o para mostrar popup de confirma√ß√£o
function mostrarPopupConfirmacao(participante) {
  document.getElementById('confirmNome').textContent = participante.nome;
  document.getElementById('confirmTelefone').textContent = participante.telefone;
  document.getElementById('confirmPix').textContent = CONFIG.PIX_PAGAMENTO;
  document.getElementById('confirmValor').textContent = CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',');
  document.getElementById('confirmPrazo').textContent = CONFIG.DATA_LIMITE_PAGAMENTO;
  
  document.getElementById('modalConfirmacao').style.display = 'flex';
}

// Fun√ß√£o para mostrar popup de pagamento (para participantes n√£o pagos)
function mostrarPopupPagamento(participante) {
  document.getElementById('confirmNome').textContent = participante.nome;
  document.getElementById('confirmTelefone').textContent = participante.telefone;
  document.getElementById('confirmPix').textContent = CONFIG.PIX_PAGAMENTO;
  document.getElementById('confirmValor').textContent = CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',');
  document.getElementById('confirmPrazo').textContent = CONFIG.DATA_LIMITE_PAGAMENTO;
  
  // Alterar t√≠tulo para indicar que √© para pagamento
  const modal = document.getElementById('modalConfirmacao');
  const titulo = modal.querySelector('h3');
  const telefoneOriginal = participante.telefone;
  titulo.textContent = 'Informa√ß√µes de Pagamento';
  
  modal.style.display = 'flex';
}

// Fun√ß√£o para mostrar popup de pagamento sobre a lista
function mostrarPopupPagamentoSobreLista(participante) {
  // Remover popup anterior se existir
  const popupExistente = document.getElementById('popupPagamentoLista');
  if (popupExistente) {
    popupExistente.remove();
  }
  
  // Criar popup
  const popup = document.createElement('div');
  popup.id = 'popupPagamentoLista';
  popup.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #00b894, #00cec9);
    padding: 25px;
    border-radius: 15px;
    max-width: 400px;
    width: 90%;
    color: #fff;
    text-align: center;
    z-index: 6000;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  `;
  
  popup.innerHTML = `
    <div style="font-size: 32px; margin-bottom: 15px;">üí≥</div>
    <h3 style="color: #fff; margin: 0 0 15px 0; font-size: 18px;">Informa√ß√µes de Pagamento</h3>
    
    <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: left;">
      <div style="margin-bottom: 10px;"><strong>Nome:</strong> ${participante.nome}</div>
      <div><strong> WhatsApp:</strong> ${participante.telefone}</div>
    </div>
    
    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; font-size: 14px;">
      <h4 style="color: #fff; margin: 0 0 10px 0; font-size: 16px;">üí≥ Para efetuar o pagamento:</h4>
      <div style="margin-bottom: 8px;"><strong>PIX:</strong> ${CONFIG.PIX_PAGAMENTO}</div>
      <div style="margin-bottom: 8px;"><strong>Valor:</strong> R$ ${CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',')}</div>
      <div><strong>Prazo:</strong> at√© ${CONFIG.DATA_LIMITE_PAGAMENTO}</div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
      <button id="btnWhatsAppPopup" style="background: linear-gradient(135deg, #25d366, #128c7e); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 14px;">üì± WhatsApp</button>
      <button id="btnCopiarPixPopup" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 14px;">üì± QR Code PIX</button>
    </div>
    
    <button id="fecharPopupPagamento" style="background: linear-gradient(135deg, #34495e, #2c3e50); color: white; padding: 12px 24px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; width: 100%;">‚úÖ Fechar</button>
  `;
  
  document.body.appendChild(popup);
  
  // Event listeners do popup
  document.getElementById('btnWhatsAppPopup').addEventListener('click', () => {
    const mensagem = `üéØ *${CONFIG.TITULO_BOLAO}*\n\nOl√°! Gostaria de efetuar o pagamento da minha participa√ß√£o no bol√£o.\n\nüë§ *Nome:* ${participante.nome}\nüì± *WhatsApp:* ${participante.telefone}\nüí∞ *Valor:* R$ ${CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',')}\nüìÖ *Prazo:* at√© ${CONFIG.DATA_LIMITE_PAGAMENTO}\nüí≥ *PIX:* ${CONFIG.PIX_PAGAMENTO}\n\nVou fazer o PIX agora e enviar o comprovante! üçÄ`;
    
    const telefoneOrganizador = CONFIG.PIX_PAGAMENTO.replace(/\D/g, '');
    const telefoneComCodigo = telefoneOrganizador.startsWith('55') ? telefoneOrganizador : '55' + telefoneOrganizador;
    const whatsappUrl = `https://wa.me/${telefoneComCodigo}?text=${encodeURIComponent(mensagem)}`;
    
    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
  });
  
  document.getElementById('btnCopiarPixPopup').addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(CONFIG.PIX_QR_CODE);
      mostrarMensagemSobreModal('üì± QR Code PIX copiado! Cole no seu app do banco.', 'success');
    } catch (err) {
      const textArea = document.createElement('textarea');
      textArea.value = CONFIG.PIX_QR_CODE;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      mostrarMensagemSobreModal('üì± QR Code PIX copiado! Cole no seu app do banco.', 'success');
    }
  });
  
  document.getElementById('fecharPopupPagamento').addEventListener('click', () => {
    popup.remove();
  });
  
  // Fechar clicando fora
  popup.addEventListener('click', (e) => {
    if (e.target === popup) {
      popup.remove();
    }
  });
}

// Fun√ß√µes do teclado virtual
function mostrarTecladoSenha(acao) {
  acaoPendente = acao;
  senhaDigitada = '';
  document.getElementById('senhaDisplay').textContent = '';
  document.getElementById('modalSenha').style.display = 'flex';
}

function adicionarDigito(digito) {
  if (senhaDigitada.length < 4) {
    senhaDigitada += digito;
    document.getElementById('senhaDisplay').textContent = '*'.repeat(senhaDigitada.length);
    
    // Se completou 4 d√≠gitos, verificar automaticamente
    if (senhaDigitada.length === 4) {
      setTimeout(() => {
        verificarSenha();
      }, 200); // Pequeno delay para mostrar o √∫ltimo *
    }
  }
}

function limparSenha() {
  senhaDigitada = '';
  document.getElementById('senhaDisplay').textContent = '';
}

function verificarSenha() {
  if (senhaDigitada === SENHA_ADM) {
    document.getElementById('modalSenha').style.display = 'none';
    executarAcao(acaoPendente);
  } else {
    mostrarMensagem('‚ùå Senha incorreta!', 'error');
    limparSenha();
  }
}

function cancelarSenha() {
  document.getElementById('modalSenha').style.display = 'none';
  senhaDigitada = '';
  acaoPendente = null;
}

// Atualizar progresso
function atualizarProgresso() {
  return get(dbRef).then((snapshot) => {
    participantes = snapshot.exists() ? Object.entries(snapshot.val()).map(([key, value]) => ({...value, key})) : [];
    
    const totalCadastrados = participantes.length;
    const totalPagos = participantes.filter(p => p.status === "Pago").length;
    const progresso = (totalCadastrados / LIMITE_PARTICIPANTES) * 100;
    const valorArrecadado = totalPagos * VALOR_PARTICIPACAO;
    
    // Atualizar barra principal
    document.getElementById('progressFill').style.width = progresso + '%';
    document.getElementById('progressText').textContent = `${totalCadastrados}/${LIMITE_PARTICIPANTES} participantes`;
    document.getElementById('progressSubtext').textContent = `Arrecadado: R$ ${valorArrecadado.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    
    // Atualizar barra da lista se estiver aberta
    const progressFillLista = document.getElementById('progressFillLista');
    const progressTextLista = document.getElementById('progressTextLista');
    if (progressFillLista && progressTextLista) {
      const progressoPagos = totalCadastrados > 0 ? (totalPagos / totalCadastrados) * 100 : 0;
      progressFillLista.style.width = progressoPagos + '%';
      progressTextLista.textContent = `${totalCadastrados}/${LIMITE_PARTICIPANTES} cadastrados ‚Ä¢ ${totalPagos} pagos`;
    }
  });
}

// Cadastrar participante
document.getElementById("cadastrar").addEventListener("click", async () => {
  const nome = document.getElementById("nome").value.trim();
  const telefone = document.getElementById("telefone").value.trim();

  if (!nome || !telefone) {
    mostrarMensagem("‚ö†Ô∏è Preencha todos os campos!", "error");
    return;
  }

  // Validar nome completo
  if (nome.split(' ').length < 2) {
    mostrarMensagem("‚ö†Ô∏è Digite o nome completo!", "error");
    return;
  }

  // Validar telefone
  if (telefone.replace(/\D/g, '').length < 11) {
    mostrarMensagem("‚ö†Ô∏è Telefone deve conter DDD + n√∫mero!", "error");
    return;
  }

  try {
    const snapshot = await get(dbRef);
    const participantesAtuais = snapshot.exists() ? Object.values(snapshot.val()) : [];

    if (participantesAtuais.length >= LIMITE_PARTICIPANTES) {
      mostrarMensagem(`‚ùå Limite de ${LIMITE_PARTICIPANTES} participantes atingido!`, "error");
      return;
    }

    // Verificar duplicatas
    const duplicado = participantesAtuais.some(p =>
      p.nome.toLowerCase() === nome.toLowerCase() ||
      p.telefone.replace(/\D/g, '') === telefone.replace(/\D/g, '')
    );

    if (duplicado) {
      mostrarMensagem("‚ö†Ô∏è Esse cadastro j√° existe!", "warning");
      return;
    }

    const novoCadastro = {
      numero: participantesAtuais.length + 1,
      nome: nome.toUpperCase(),
      telefone,
      status: "N√£o pago",
      dataCadastro: new Date().toISOString()
    };

    // Salva o novo cadastro primeiro
    const novoParticipanteRef = await push(dbRef, novoCadastro);
    
    // Atualiza o campo key do novo participante
    const novoParticipante = {...novoCadastro, key: novoParticipanteRef.key};
    
    document.getElementById("nome").value = "";
    document.getElementById("telefone").value = "";
    
    // Mostrar popup de confirma√ß√£o
    mostrarPopupConfirmacao(novoParticipante);
    
    // Atualiza o progresso e envia a lista para o Telegram
    await atualizarProgresso();
    await enviarListaTelegram();
    
  } catch (error) {
    console.error("Erro:", error);
    mostrarMensagem("‚ùå Erro ao cadastrar. Tente novamente!", "error");
  }
});

// Ver lista
document.getElementById("verLista").addEventListener("click", async () => {
  try {
    await atualizarProgresso();
    exibirLista();
    document.getElementById("overlay").style.display = "flex";
  } catch (error) {
    console.error("Erro:", error);
    mostrarMensagem("‚ùå Erro ao carregar lista!", "error");
  }
});

// Exibir lista
function exibirLista() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  if (participantes.length === 0) {
    lista.innerHTML = '<div style="text-align: center; padding: 20px; opacity: 0.7;">Nenhum participante encontrado</div>';
    return;
  }

  participantes
    .sort((a, b) => a.numero - b.numero)
    .forEach(participante => {
      const div = document.createElement("div");
      div.className = "participante";
      div.innerHTML = `
        <input type="checkbox" id="check-${participante.key}" style="margin: 0; cursor: pointer; width: 16px; height: 16px;">
        <span style="flex: 1;">${formatarNumero(participante.numero)}. ${participante.nome}</span>
        <span class="status ${participante.status.toLowerCase().replace(' ', '-')}" title="${participante.status === "Pago" ? "Pago" : "N√£o pago"}">${participante.status === "Pago" ? "‚úÖ" : "‚ùå"}</span>
      `;
      
      const checkbox = div.querySelector('input[type="checkbox"]');
      
      checkbox.addEventListener('change', (e) => {
        e.stopPropagation();
        if (checkbox.checked) {
          participantesSelecionados.push(participante);
          div.style.background = 'rgba(255, 215, 0, 0.3)';
        } else {
          participantesSelecionados = participantesSelecionados.filter(p => p.key !== participante.key);
          div.style.background = 'rgba(255, 255, 255, 0.1)';
        }
      });
      
      div.addEventListener('click', (e) => {
        if (e.target.type !== 'checkbox' && !e.target.classList.contains('status')) {
          // Se j√° pagou, apenas selecionar
          checkbox.checked = !checkbox.checked;
          checkbox.dispatchEvent(new Event('change'));
        }
      });
      
      // Event listener espec√≠fico para o status "N√£o pago"
      const statusElement = div.querySelector('.status');
      if (participante.status === "N√£o pago") {
        statusElement.addEventListener('click', (e) => {
          e.stopPropagation();
          mostrarPopupPagamentoSobreLista(participante);
        });
      }
      
      lista.appendChild(div);
    });
}

// Buscar
document.getElementById("buscar").addEventListener("input", (e) => {
  const termo = e.target.value.toLowerCase();
  const participantesFiltrados = participantes.filter(p => 
    p.nome.toLowerCase().includes(termo) || 
    p.telefone.includes(termo) ||
    p.numero.toString().includes(termo)
  );
  
  exibirListaFiltrada(participantesFiltrados);
});

// Fun√ß√£o para exibir lista filtrada
function exibirListaFiltrada(participantesFiltrados) {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";
  
  participantesFiltrados.forEach(participante => {
    const div = document.createElement("div");
    div.className = "participante";
    div.innerHTML = `
      <input type="checkbox" id="check-${participante.key}" style="margin: 0; cursor: pointer; width: 16px; height: 16px;">
      <span style="flex: 1;">${formatarNumero(participante.numero)}. ${participante.nome}</span>
      <span class="status ${participante.status.toLowerCase().replace(' ', '-')}" title="${participante.status === "Pago" ? "Pago" : "N√£o pago"}">${participante.status === "Pago" ? "‚úÖ" : "‚ùå"}</span>
    `;
    
    const checkbox = div.querySelector('input[type="checkbox"]');
    
    // Manter sele√ß√£o se j√° estava selecionado
    if (participantesSelecionados.some(p => p.key === participante.key)) {
      checkbox.checked = true;
      div.style.background = 'rgba(255, 215, 0, 0.3)';
    }
    
    checkbox.addEventListener('change', (e) => {
      e.stopPropagation();
      if (checkbox.checked) {
        if (!participantesSelecionados.some(p => p.key === participante.key)) {
          participantesSelecionados.push(participante);
        }
        div.style.background = 'rgba(255, 215, 0, 0.3)';
      } else {
        participantesSelecionados = participantesSelecionados.filter(p => p.key !== participante.key);
        div.style.background = 'rgba(255, 255, 255, 0.1)';
      }
    });
    
    div.addEventListener('click', (e) => {
      if (e.target.type !== 'checkbox' && !e.target.classList.contains('status')) {
        // Se j√° pagou, apenas selecionar
        checkbox.checked = !checkbox.checked;
        checkbox.dispatchEvent(new Event('change'));
      }
    });
    
    // Event listener espec√≠fico para o status "N√£o pago"
    const statusElement = div.querySelector('.status');
    if (participante.status === "N√£o pago") {
      statusElement.addEventListener('click', (e) => {
        e.stopPropagation();
        mostrarPopupPagamentoSobreLista(participante);
      });
    }
    
    lista.appendChild(div);
  });
}

// Bot√£o Filtros
document.getElementById("filtroBtn").addEventListener("click", () => {
  const menuFiltros = document.getElementById("menuFiltros");
  const menuAcoes = document.getElementById("menuAcoes");
  
  // Se o menu filtros est√° fechado, abrir e fechar o de a√ß√µes
  if (menuFiltros.style.display === "none" || menuFiltros.style.display === "") {
    menuFiltros.style.display = "block";
    menuAcoes.style.display = "none";
  } else {
    // Se est√° aberto, fechar
    menuFiltros.style.display = "none";
  }
});

// Bot√£o A√ß√µes
document.getElementById("acaoBtn").addEventListener("click", () => {
  const menuFiltros = document.getElementById("menuFiltros");
  const menuAcoes = document.getElementById("menuAcoes");
  
  // Se o menu a√ß√µes est√° fechado, abrir e fechar o de filtros
  if (menuAcoes.style.display === "none" || menuAcoes.style.display === "") {
    menuAcoes.style.display = "block";
    menuFiltros.style.display = "none";
  } else {
    // Se est√° aberto, fechar
    menuAcoes.style.display = "none";
  }
});

// Filtros
document.getElementById("filtroTodos").addEventListener("click", () => {
  exibirListaFiltrada(participantes);
});

document.getElementById("filtroPagos").addEventListener("click", () => {
  const participantesPagos = participantes.filter(p => p.status === "Pago");
  exibirListaFiltrada(participantesPagos);
});

document.getElementById("filtroNaoPagos").addEventListener("click", () => {
  const participantesPendentes = participantes.filter(p => p.status === "N√£o pago");
  exibirListaFiltrada(participantesPendentes);
});

// Fun√ß√£o para executar a√ß√µes ap√≥s autentica√ß√£o
async function executarAcao(acao) {
  if (participantesSelecionados.length === 0) {
    mostrarMensagem("‚ö†Ô∏è Selecione pelo menos um participante!", "warning");
    return;
  }

  try {
    switch (acao) {
      case 'alterarStatus':
        const updates = {};
        for (const participante of participantesSelecionados) {
          const novoStatus = participante.status === "Pago" ? "N√£o pago" : "Pago";
          updates[`participantes/${participante.key}/status`] = novoStatus;
        }
        await update(ref(db), updates);
        mostrarMensagem(`‚úÖ Status alterado para ${participantesSelecionados.length} participante(s)!`, "success");
        break;

      case 'notificar':
        participantesSelecionados.forEach((participante, index) => {
          setTimeout(() => {
            const mensagem = `üéØ *${CONFIG.TITULO_BOLAO}*\n\nOl√° ${participante.nome.split(' ')[0]}!\n\nSua vaga est√° reservada no nosso bol√£o!\n\nüí∞ *Valor:* R$ ${CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',')}\nüìÖ *Prazo:* at√© ${CONFIG.DATA_LIMITE_PAGAMENTO}\nüí≥ *PIX:* ${CONFIG.PIX_PAGAMENTO}\n\n‚ö†Ô∏è *IMPORTANTE:* Quem n√£o pagar at√© ${CONFIG.DATA_LIMITE_PAGAMENTO.split(' ')[0]}/${CONFIG.DATA_LIMITE_PAGAMENTO.split(' ')[2]} ser√° exclu√≠do automaticamente.\n\nAp√≥s o pagamento, envie o comprovante!\n\n*Garanta sua vaga!* üçÄ`;
            
            const telefoneFormatado = participante.telefone.replace(/\D/g, '');
            const telefoneComCodigo = telefoneFormatado.startsWith('55') ? telefoneFormatado : '55' + telefoneFormatado;
            const whatsappUrl = `https://wa.me/${telefoneComCodigo}?text=${encodeURIComponent(mensagem)}`;
            
            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
          }, index * 1000);
        });
        mostrarMensagem(`üì± WhatsApp aberto para ${participantesSelecionados.length} participante(s)!`, "success");
        break;

      case 'excluir':
        const nomes = participantesSelecionados.map(p => p.nome.split(' ')[0]).join(', ');
        if (!confirm(`Tem certeza que deseja excluir ${participantesSelecionados.length} participante(s)?\n\n${nomes}`)) {
          return;
        }
        
        const deleteUpdates = {};
        for (const participante of participantesSelecionados) {
          deleteUpdates[`participantes/${participante.key}`] = null;
        }
        await update(ref(db), deleteUpdates);
        mostrarMensagem(`‚úÖ ${participantesSelecionados.length} participante(s) exclu√≠do(s)!`, "success");
        break;
    }

    // Sincroniza√ß√£o instant√¢nea ap√≥s qualquer a√ß√£o
    participantesSelecionados = [];
    await atualizarProgresso();
    exibirLista();
    
  } catch (error) {
    console.error("Erro:", error);
    mostrarMensagem("‚ùå Erro ao executar a√ß√£o!", "error");
  }
}

// Event listeners para a√ß√µes com autentica√ß√£o
document.getElementById("alterarStatus").addEventListener("click", () => {
  if (participantesSelecionados.length === 0) {
    mostrarMensagem("‚ö†Ô∏è Selecione pelo menos um participante!", "warning");
    return;
  }
  mostrarTecladoSenha('alterarStatus');
});

document.getElementById("notificar").addEventListener("click", () => {
  if (participantesSelecionados.length === 0) {
    mostrarMensagem("‚ö†Ô∏è Selecione pelo menos um participante!", "warning");
    return;
  }
  mostrarTecladoSenha('notificar');
});

document.getElementById("excluir").addEventListener("click", () => {
  if (participantesSelecionados.length === 0) {
    mostrarMensagem("‚ö†Ô∏è Selecione pelo menos um participante!", "warning");
    return;
  }
  mostrarTecladoSenha('excluir');
});

// Event listeners do teclado virtual
document.querySelectorAll('.num-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    adicionarDigito(btn.dataset.num);
  });
});

document.getElementById('limparSenha').addEventListener('click', limparSenha);
document.getElementById('cancelarSenha').addEventListener('click', cancelarSenha);

// Event listeners dos modais
document.getElementById('verRegras').addEventListener('click', () => {
  document.getElementById('modalRegras').style.display = 'flex';
});

document.getElementById('fecharRegras').addEventListener('click', () => {
  document.getElementById('modalRegras').style.display = 'none';
});

// Fechar modais clicando fora
document.getElementById('modalRegras').addEventListener('click', (e) => {
  if (e.target === document.getElementById('modalRegras')) {
    document.getElementById('modalRegras').style.display = 'none';
  }
});

// Event listeners do modal de confirma√ß√£o
document.getElementById('fecharConfirmacao').addEventListener('click', () => {
  document.getElementById('modalConfirmacao').style.display = 'none';
  // Restaurar t√≠tulo original
  const modal = document.getElementById('modalConfirmacao');
  const titulo = modal.querySelector('h3');
  titulo.textContent = 'Cadastro Realizado!';
});

document.getElementById('btnWhatsAppPagamento').addEventListener('click', () => {
  const nome = document.getElementById('confirmNome').textContent;
  const telefone = document.getElementById('confirmTelefone').textContent;
  const valor = document.getElementById('confirmValor').textContent;
  const prazo = document.getElementById('confirmPrazo').textContent;
  const pix = document.getElementById('confirmPix').textContent;
  
  const mensagem = `üéØ *${CONFIG.TITULO_BOLAO}*\n\nOl√°! Gostaria de efetuar o pagamento da minha participa√ß√£o no bol√£o.\n\nüë§ *Nome:* ${nome}\nüì± *WhatsApp:* ${telefone}\nüí∞ *Valor:* R$ ${valor}\nüìÖ *Prazo:* at√© ${prazo}\nüí≥ *PIX:* ${pix}\n\nVou fazer o PIX agora e enviar o comprovante! üçÄ`;
  
  // Usar o PIX como n√∫mero do WhatsApp (que √© o organizador)
  const telefoneOrganizador = CONFIG.PIX_PAGAMENTO.replace(/\D/g, '');
  const telefoneComCodigo = telefoneOrganizador.startsWith('55') ? telefoneOrganizador : '55' + telefoneOrganizador;
  const whatsappUrl = `https://wa.me/${telefoneComCodigo}?text=${encodeURIComponent(mensagem)}`;
  
  window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
});

// Fun√ß√£o para gerar QR Code
function gerarQRCode(texto) {
  const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(texto)}`;
  return qrCodeUrl;
}

// Event listener para o QR Code PIX
document.getElementById('btnCopiarPix').addEventListener('click', () => {
  const pixQrCode = CONFIG.PIX_QR_CODE;
  const qrCodeUrl = gerarQRCode(pixQrCode);
  const qrCodeImage = document.getElementById('qrCodeImage');
  const qrCodeContainer = document.getElementById('qrCodeContainer');
  
  qrCodeImage.src = qrCodeUrl;
  qrCodeContainer.style.display = 'block';
  
  // Scroll para o QR Code
  qrCodeContainer.scrollIntoView({ behavior: 'smooth' });
});

// Fechar modal clicando fora
document.getElementById('modalConfirmacao').addEventListener('click', (e) => {
  if (e.target === document.getElementById('modalConfirmacao')) {
    document.getElementById('modalConfirmacao').style.display = 'none';
    // Restaurar t√≠tulo original
    const modal = document.getElementById('modalConfirmacao');
    const titulo = modal.querySelector('h3');
    titulo.textContent = 'Cadastro Realizado!';
  }
});

// Fechar modal
document.getElementById("fecharLista").addEventListener("click", () => {
  document.getElementById("overlay").style.display = "none";
  participanteSelecionado = null;
  participantesSelecionados = [];
});

// Fechar modal clicando fora
document.getElementById("overlay").addEventListener("click", (e) => {
  if (e.target === document.getElementById("overlay")) {
    document.getElementById("overlay").style.display = "none";
    participanteSelecionado = null;
    participantesSelecionados = [];
  }
});

// Fun√ß√£o para inicializar elementos
function inicializarElementos() {
  // Atualizar t√≠tulo da p√°gina
  document.title = CONFIG.TITULO_BOLAO;
  document.getElementById('tituloBolao').textContent = `üéØ ${CONFIG.TITULO_BOLAO}`;
  
  // Atualizar informa√ß√µes gerais
  document.getElementById('infoGeral').innerHTML = `
    üé∞ <strong>${CONFIG.LIMITE_PARTICIPANTES} participantes</strong> ‚Ä¢ üí∞ <strong>R$ ${CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',')} por pessoa</strong><br>
    <div style="margin-top: 10px;">
      <span class="prize-button">üèÜ Premia√ß√£o Estimada: R$ ${CONFIG.PREMIACAO_ESTIMADA.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
    </div>
    üìÖ <strong>Pagamento:</strong> at√© ${CONFIG.DATA_LIMITE_PAGAMENTO}<br>
    <small>üìã Preencha os dados para garantir sua vaga!</small>
  `;
  
  // Atualizar modal de regras
  const modalRegras = document.getElementById('modalRegras');
  if (modalRegras) {
    modalRegras.querySelector('h3').textContent = `‚ö†Ô∏è INFORMATIVO: BOL√ÉO MEGA DA VIRADA ${CONFIG.ANO_SORTEIO} ‚ö†Ô∏è`;
    
    const conteudoRegras = modalRegras.querySelector('div[style*="text-align: left"]');
    conteudoRegras.innerHTML = `
      <p style="margin-bottom: 15px;">Estamos organizando nosso bol√£o, com um total de <strong style="color: #ffd700;">${CONFIG.LIMITE_PARTICIPANTES} participantes</strong>.</p>
      
      <p style="margin-bottom: 15px;"><strong style="color: #00b894;">Custo por Participante:</strong> R$ ${CONFIG.VALOR_PARTICIPACAO.toFixed(2).replace('.', ',')}</p>
      
      <h4 style="color: #ffd700; margin: 20px 0 10px 0; font-size: 16px;">üìã Regras de Participa√ß√£o e Prazos:</h4>
      
      <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
        <h5 style="color: #e74c3c; margin: 0 0 10px 0;">üìÖ Datas Limite:</h5>
        <p style="margin: 0;"><strong>${CONFIG.DATA_LIMITE_INTERESSE}:</strong> Data final para manifestar interesse (confirmar que quer participar).<br>
        <strong>${CONFIG.DATA_LIMITE_PAGAMENTO}:</strong> Data final para o pagamento da cota.</p>
      </div>
      
      <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #e74c3c;">
        <h5 style="color: #e74c3c; margin: 0 0 10px 0;">‚ö†Ô∏è Aten√ß√£o ao Pagamento:</h5>
        <p style="margin: 0;">O participante que n√£o realizar o pagamento at√© o dia <strong>${CONFIG.DATA_LIMITE_PAGAMENTO}</strong> ser√° automaticamente exclu√≠do do bol√£o, e a vaga ser√° repassada.</p>
      </div>
      
      <h4 style="color: #ffd700; margin: 20px 0 10px 0; font-size: 16px;">üí° Observa√ß√µes Importantes:</h4>
      
      <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px;">
        <p style="margin: 0 0 10px 0;"><strong style="color: #f39c12;">Prazos:</strong> As datas foram definidas para que todos tenham tempo suficiente para pagar (contando com o 13¬∫ sal√°rio).</p>
        
        <p style="margin: 0 0 10px 0;"><strong style="color: #f39c12;">Agilidade:</strong> Quanto antes arrecadarmos o valor, melhor. Deixar para a √∫ltima hora significa enfrentar lot√©ricas lotadas.</p>
        
        <p style="margin: 0;"><strong style="color: #f39c12;">Jogos:</strong> A quantidade final de bilhetes e jogos ser√° definida ao t√©rmino da arrecada√ß√£o, pois depender√° do valor total arrecadado (se todas as ${CONFIG.LIMITE_PARTICIPANTES} cotas forem preenchidas).</p>
      </div>
    `;
  }
  
  // Atualizar texto da barra de progresso
  document.getElementById('progressText').textContent = `0/${CONFIG.LIMITE_PARTICIPANTES} participantes`;
}

// Inicializar elementos quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', () => {
  inicializarElementos();
  // Carregar dados iniciais
  atualizarProgresso();
});
</script>
</body>
</html>
