<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bolão Final Libertadores - Exportar Imagem</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Ícones -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- Biblioteca para gerar Imagem (html2canvas) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Estilos de Impressão */
        @media print {
            body { background-color: white !important; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-container { box-shadow: none !important; margin: 0 !important; width: 100% !important; max-width: none !important; }
            @page { size: A4 landscape; margin: 10mm; }
        }

        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); }
        .card-shadow { box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="min-h-screen pb-10">

    <div class="fixed inset-0 gradient-bg -z-10 no-print"></div>

    <!-- CONTROLES -->
    <div class="no-print max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-xl card-shadow p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div>
                    <h1 class="text-2xl font-extrabold text-blue-900 flex items-center gap-2">
                        <i class="ph ph-trophy text-yellow-500"></i> Bolão Final Libertadores
                    </h1>
                    <p class="text-gray-500 text-sm">Gerar ficheiros para impressão e partilha</p>
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <button onclick="toggleEdit()" class="flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-lg font-semibold text-sm transition-all">
                        <i class="ph ph-pencil-simple"></i> <span id="btnEditText">Editar</span>
                    </button>
                    
                    <!-- Botão Word -->
                    <button onclick="exportToWord()" class="flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 text-sm transition-all">
                        <i class="ph ph-file-doc"></i> Word
                    </button>

                    <!-- NOVO: Botão Imagem -->
                    <button onclick="downloadImage()" class="flex items-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg font-semibold shadow hover:bg-purple-700 text-sm transition-all">
                        <i class="ph ph-image"></i> Baixar Imagem
                    </button>

                    <button onclick="window.print()" class="flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg font-semibold shadow hover:bg-green-700 text-sm transition-all">
                        <i class="ph ph-printer"></i> Imprimir
                    </button>
                </div>
            </div>

            <!-- Área de Edição -->
            <div id="editForm" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 bg-blue-50 p-4 rounded-xl border border-blue-100">
                <div class="flex flex-col"><label class="text-[10px] font-bold uppercase text-blue-800">Título</label><input type="text" id="confTitle" class="border p-2 rounded" oninput="updateUI()"></div>
                <div class="flex flex-col"><label class="text-[10px] font-bold uppercase text-blue-800">Time A</label><input type="text" id="confTeamA" class="border p-2 rounded" oninput="updateUI()"></div>
                <div class="flex flex-col"><label class="text-[10px] font-bold uppercase text-blue-800">Time B</label><input type="text" id="confTeamB" class="border p-2 rounded" oninput="updateUI()"></div>
                <div class="flex flex-col"><label class="text-[10px] font-bold uppercase text-blue-800">Valor</label><input type="number" id="confValue" class="border p-2 rounded" step="0.5" oninput="updateUI()"></div>
                <div class="flex flex-col"><label class="text-[10px] font-bold uppercase text-blue-800">Pix</label><input type="text" id="confPix" class="border p-2 rounded" oninput="updateUI()"></div>
                <div class="flex flex-col"><label class="text-[10px] font-bold uppercase text-blue-800">Prêmio</label><input type="text" id="confPrize" class="border p-2 rounded" oninput="updateUI()"></div>
            </div>
        </div>
    </div>

    <!-- ÁREA DO BOLÃO (O que será transformado em imagem) -->
    <div id="printArea" class="print-container mx-auto bg-white card-shadow w-[297mm] min-h-[210mm] p-8 relative">
        <!-- Header -->
        <header class="flex justify-between items-end border-b-4 border-gray-800 pb-4 mb-6">
            <div>
                <h1 id="dispTitle" class="text-4xl font-black text-gray-900 uppercase tracking-tight">Bolão da Final da Libertadores</h1>
                <p class="text-gray-500 font-medium text-sm mt-1 flex items-center gap-1">
                    <i class="ph-fill ph-check-circle text-green-500"></i> Organização Oficial
                </p>
            </div>
            <div class="flex gap-4 text-center">
                <div class="bg-gray-100 p-2 rounded w-24 border border-gray-200">
                    <div class="text-[10px] text-gray-500 font-bold uppercase">Valor</div>
                    <div class="font-black text-xl text-gray-800">R$ <span id="dispValue">5,00</span></div>
                </div>
                <div class="bg-gray-100 p-2 rounded w-48 border border-gray-200 flex flex-col justify-center">
                    <div class="text-[10px] text-gray-500 font-bold uppercase">Prêmio</div>
                    <div id="dispPrizeText" class="font-bold text-sm text-green-700 leading-tight">70% do arrecadado</div>
                </div>
                <div class="bg-gray-800 text-white p-2 rounded w-32 border border-gray-800 flex flex-col justify-center">
                    <div class="text-[10px] text-gray-400 font-bold uppercase flex justify-center items-center gap-1"><i class="ph ph-qr-code"></i> Pix</div>
                    <div id="dispPix" class="font-bold text-sm truncate">99984511179</div>
                </div>
            </div>
        </header>

        <!-- Grade Web (Layout de 2 Colunas) -->
        <div id="webGrid" class="columns-2 gap-8">
            <!-- Preenchido via JS -->
        </div>
        
        <div class="mt-8 pt-4 border-t border-gray-200 flex justify-between text-[10px] text-gray-400 font-medium uppercase">
            <span>Documento Gerado Digitalmente</span>
            <span>Boa Sorte aos Participantes!</span>
        </div>
    </div>

    <script>
        // CONFIGURAÇÃO
        const config = {
            title: 'Bolão da Final da Libertadores',
            teamA: 'Flamengo',
            teamB: 'Palmeiras',
            value: 5.00,
            pix: '99984511179',
            prizeText: '70% do valor arrecadado'
        };

        // Init
        document.getElementById('confTitle').value = config.title;
        document.getElementById('confTeamA').value = config.teamA;
        document.getElementById('confTeamB').value = config.teamB;
        document.getElementById('confValue').value = config.value;
        document.getElementById('confPix').value = config.pix;
        document.getElementById('confPrize').value = config.prizeText;

        function updateUI() {
            config.title = document.getElementById('confTitle').value;
            config.teamA = document.getElementById('confTeamA').value;
            config.teamB = document.getElementById('confTeamB').value;
            config.value = document.getElementById('confValue').value;
            config.pix = document.getElementById('confPix').value;
            config.prizeText = document.getElementById('confPrize').value;

            document.getElementById('dispTitle').innerText = config.title;
            document.getElementById('dispValue').innerText = parseFloat(config.value).toFixed(2).replace('.',',');
            document.getElementById('dispPix').innerText = config.pix;
            document.getElementById('dispPrizeText').innerText = config.prizeText;

            renderWebGrid();
        }

        function toggleEdit() {
            const form = document.getElementById('editForm');
            const btn = document.getElementById('btnEditText');
            if(form.classList.contains('hidden')){
                form.classList.remove('hidden');
                btn.innerText = 'Fechar';
            } else {
                form.classList.add('hidden');
                btn.innerText = 'Editar';
            }
        }

        function renderWebGrid() {
            const grid = document.getElementById('webGrid');
            const total = 200;
            const blockSize = 25; 
            let html = '';
            
            const createRows = (start, end) => {
                let rows = '';
                for(let i=start+1; i<=end; i++){
                    rows += `
                    <div class="flex items-center border-b border-gray-200 text-xs h-8">
                        <div class="w-10 font-bold text-gray-500 text-center bg-gray-50 h-full flex items-center justify-center border-r text-[10px]">${String(i).padStart(3,'0')}</div>
                        <div class="w-28 text-center font-bold border-r h-full flex items-center justify-center bg-white px-1 text-[11px]">
                            ${config.teamA.substring(0,3).toUpperCase()} <span class="mx-1 text-gray-300 font-light">x</span> ${config.teamB.substring(0,3).toUpperCase()}
                        </div>
                        <div class="flex-grow h-full relative">
                             <!-- Linha para escrever nome -->
                             <div class="absolute bottom-1.5 left-2 right-2 border-b border-dotted border-gray-300"></div>
                        </div>
                    </div>`;
                }
                return rows;
            };

            for(let i=0; i<total; i+=blockSize) {
                html += `<div class="break-inside-avoid mb-6 border border-gray-300 rounded overflow-hidden bg-white shadow-sm">
                    <div class="bg-gray-100 text-[10px] font-bold uppercase py-1.5 text-center border-b border-gray-300 flex text-gray-600">
                        <div class="w-10 border-r">#</div>
                        <div class="w-28 border-r">Placar</div>
                        <div class="flex-grow">Nome do Participante</div>
                    </div>
                    ${createRows(i, Math.min(i+blockSize, total))}
                </div>`;
            }
            grid.innerHTML = html;
        }

        // --- FUNÇÃO PARA BAIXAR IMAGEM ---
        function downloadImage() {
            const element = document.getElementById("printArea");
            
            // Feedback visual
            const oldText = document.querySelector('button[onclick="downloadImage()"]').innerText;
            document.querySelector('button[onclick="downloadImage()"]').innerText = "Gerando...";

            html2canvas(element, {
                scale: 2, // Aumenta a resolução (2x) para ficar nítido
                useCORS: true,
                backgroundColor: "#ffffff", // Garante fundo branco
                logging: false
            }).then(canvas => {
                // Cria um link falso para download
                const link = document.createElement('a');
                link.download = 'Bolao_Libertadores.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
                
                document.querySelector('button[onclick="downloadImage()"]').innerText = oldText;
            }).catch(err => {
                console.error("Erro ao gerar imagem:", err);
                alert("Erro ao gerar imagem. Tente usar o botão Imprimir > Salvar como PDF.");
                document.querySelector('button[onclick="downloadImage()"]').innerText = oldText;
            });
        }

        // --- FUNÇÃO WORD ---
        function exportToWord() {
            // (Mesma lógica do passo anterior, mantida para funcionalidade completa)
            const tableContent = generateWordTableRows();
            const preHtml = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'><head><meta charset='utf-8'><title>Doc</title>
            <style>@page{mso-page-orientation:landscape;size:29.7cm 21.0cm;margin:1cm;}body{font-family:Arial;}table{border-collapse:collapse;width:100%;font-size:10pt;}td{border:1px solid #000;height:25px;text-align:center;}.col-name{width:200px;text-align:left;}.col-gap{border:none;width:20px;}</style></head><body>`;
            
            const headerHtml = `<div style="text-align:center;margin-bottom:20px"><h1 style="margin:0">${config.title.toUpperCase()}</h1><p style="margin:5px">R$ ${config.value} | Pix: ${config.pix} | ${config.prizeText}</p></div>`;
            
            const content = preHtml + headerHtml + "<table>" + tableContent + "</table></body></html>";
            const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.download = 'Bolao_Libertadores.doc';
            link.href = url;
            link.click();
        }

        function generateWordTableRows() {
            let rows = '';
            for(let i=1; i<=100; i++) {
                rows += `<tr><td>${i}</td><td></td><td>x</td><td></td><td class="col-name"></td><td class="col-gap"></td><td>${i+100}</td><td></td><td>x</td><td></td><td class="col-name"></td></tr>`;
            }
            return rows;
        }

        updateUI();
    </script>
</body>
</html>

